package(default_visibility = ["//visibility:public"])

link_options = select({
    "@bazel_tools//src/conditions:darwin": ["-undefined dynamic_lookup"],
    "//conditions:default": [
        "--shared",
        "-fuse-ld=gold",
        "-Wl,--gc-sections",
    ],
})

compile_options = select({
    "@bazel_tools//src/conditions:darwin": [],
    "//conditions:default": [
        "-Werror",
        "-Wall",
        "-Wpedantic",
        "-Wimplicit-fallthrough",
        "-Wunused",
        "-Wvla",
        "-Wno-int-in-bool-context",
        "-Wno-sign-compare",
        "-Wno-unknown-pragmas",
        "-Wimplicit-fallthrough=5",
        "-Wno-maybe-uninitialized",
        "-march=native",
    ],
})

cc_library(
    name = "C_mujoco",
    srcs = glob([
        "src/**/*.c",
        "src/**/*.cc",
        "src/**/*.h",
        "src/**/*.inc",
    ]),
    hdrs = glob(["include/mujoco/*.h"]),
    copts = [
        "-fPIC",
    ],
    defines = ["mjUSEPLATFORMSIMD"],
    includes = [
        "include",
        "src",
    ],
    linkopts = link_options,
    local_defines = [
        "_GNU_SOURCE",
        "CCD_STATIC_DEFINE",
        "MUJOCO_DLL_EXPORTS",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "@ccd//:ccd",
        "@lodepng//:lodepng",
        "@qhull//:qhull",
        "@tinyobjloader//:tinyobjloader",
        "@tinyxml2//:tinyxml2",
    ],
)